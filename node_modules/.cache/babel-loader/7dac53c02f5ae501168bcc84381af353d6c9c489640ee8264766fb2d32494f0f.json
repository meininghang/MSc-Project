{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.typed-array.to-reversed.js\");\nrequire(\"core-js/modules/es.typed-array.to-sorted.js\");\nrequire(\"core-js/modules/es.typed-array.with.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst error_1 = require(\"./lib/error\");\nconst ArweaveUtils = require(\"./lib/utils\");\nclass Chunks {\n  constructor(api) {\n    this.api = api;\n  }\n  async getTransactionOffset(id) {\n    const resp = await this.api.get(`tx/${id}/offset`);\n    if (resp.status === 200) {\n      return resp.data;\n    }\n    throw new Error(`Unable to get transaction offset: ${(0, error_1.getError)(resp)}`);\n  }\n  async getChunk(offset) {\n    const resp = await this.api.get(`chunk/${offset}`);\n    if (resp.status === 200) {\n      return resp.data;\n    }\n    throw new Error(`Unable to get chunk: ${(0, error_1.getError)(resp)}`);\n  }\n  async getChunkData(offset) {\n    const chunk = await this.getChunk(offset);\n    const buf = ArweaveUtils.b64UrlToBuffer(chunk.chunk);\n    return buf;\n  }\n  firstChunkOffset(offsetResponse) {\n    return parseInt(offsetResponse.offset) - parseInt(offsetResponse.size) + 1;\n  }\n  async downloadChunkedData(id) {\n    const offsetResponse = await this.getTransactionOffset(id);\n    const size = parseInt(offsetResponse.size);\n    const endOffset = parseInt(offsetResponse.offset);\n    const startOffset = endOffset - size + 1;\n    const data = new Uint8Array(size);\n    let byte = 0;\n    while (byte < size) {\n      if (this.api.config.logging) {\n        console.log(`[chunk] ${byte}/${size}`);\n      }\n      let chunkData;\n      try {\n        chunkData = await this.getChunkData(startOffset + byte);\n      } catch (error) {\n        console.error(`[chunk] Failed to fetch chunk at offset ${startOffset + byte}`);\n        console.error(`[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node`);\n      }\n      if (chunkData) {\n        data.set(chunkData, byte);\n        byte += chunkData.length;\n      } else {\n        throw new Error(`Couldn't complete data download at ${byte}/${size}`);\n      }\n    }\n    return data;\n  }\n}\nexports.default = Chunks;","map":{"version":3,"names":["error_1","require","ArweaveUtils","Chunks","constructor","api","getTransactionOffset","id","resp","get","status","data","Error","getError","getChunk","offset","getChunkData","chunk","buf","b64UrlToBuffer","firstChunkOffset","offsetResponse","parseInt","size","downloadChunkedData","endOffset","startOffset","Uint8Array","byte","config","logging","console","log","chunkData","error","set","length","exports","default"],"sources":["../../../src/common/chunks.ts"],"sourcesContent":[null],"mappings":";;;;;;;;AACA,MAAAA,OAAA,GAAAC,OAAA;AACA,MAAAC,YAAA,GAAAD,OAAA;AAaA,MAAqBE,MAAM;EACzBC,YAAoBC,GAAQ;IAAR,KAAAA,GAAG,GAAHA,GAAG;EAAQ;EAE/B,MAAMC,oBAAoBA,CAACC,EAAU;IACnC,MAAMC,IAAI,GAAG,MAAM,IAAI,CAACH,GAAG,CAACI,GAAG,CAAC,MAAMF,EAAE,SAAS,CAAC;IAClD,IAAIC,IAAI,CAACE,MAAM,KAAK,GAAG,EAAE;MACvB,OAAOF,IAAI,CAACG,IAAI;;IAElB,MAAM,IAAIC,KAAK,CAAC,qCAAqC,IAAAZ,OAAA,CAAAa,QAAQ,EAACL,IAAI,CAAC,EAAE,CAAC;EACxE;EAEA,MAAMM,QAAQA,CACZC,MAAgC;IAEhC,MAAMP,IAAI,GAAG,MAAM,IAAI,CAACH,GAAG,CAACI,GAAG,CAAC,SAASM,MAAM,EAAE,CAAC;IAClD,IAAIP,IAAI,CAACE,MAAM,KAAK,GAAG,EAAE;MACvB,OAAOF,IAAI,CAACG,IAAI;;IAElB,MAAM,IAAIC,KAAK,CAAC,wBAAwB,IAAAZ,OAAA,CAAAa,QAAQ,EAACL,IAAI,CAAC,EAAE,CAAC;EAC3D;EAEA,MAAMQ,YAAYA,CAACD,MAAgC;IACjD,MAAME,KAAK,GAAG,MAAM,IAAI,CAACH,QAAQ,CAACC,MAAM,CAAC;IACzC,MAAMG,GAAG,GAAGhB,YAAY,CAACiB,cAAc,CAACF,KAAK,CAACA,KAAK,CAAC;IACpD,OAAOC,GAAG;EACZ;EAEAE,gBAAgBA,CAACC,cAAyC;IACxD,OAAOC,QAAQ,CAACD,cAAc,CAACN,MAAM,CAAC,GAAGO,QAAQ,CAACD,cAAc,CAACE,IAAI,CAAC,GAAG,CAAC;EAC5E;EAEA,MAAMC,mBAAmBA,CAACjB,EAAU;IAClC,MAAMc,cAAc,GAAG,MAAM,IAAI,CAACf,oBAAoB,CAACC,EAAE,CAAC;IAC1D,MAAMgB,IAAI,GAAGD,QAAQ,CAACD,cAAc,CAACE,IAAI,CAAC;IAC1C,MAAME,SAAS,GAAGH,QAAQ,CAACD,cAAc,CAACN,MAAM,CAAC;IACjD,MAAMW,WAAW,GAAGD,SAAS,GAAGF,IAAI,GAAG,CAAC;IAExC,MAAMZ,IAAI,GAAG,IAAIgB,UAAU,CAACJ,IAAI,CAAC;IACjC,IAAIK,IAAI,GAAG,CAAC;IAEZ,OAAOA,IAAI,GAAGL,IAAI,EAAE;MAClB,IAAI,IAAI,CAAClB,GAAG,CAACwB,MAAM,CAACC,OAAO,EAAE;QAC3BC,OAAO,CAACC,GAAG,CAAC,WAAWJ,IAAI,IAAIL,IAAI,EAAE,CAAC;;MAGxC,IAAIU,SAAS;MACb,IAAI;QACFA,SAAS,GAAG,MAAM,IAAI,CAACjB,YAAY,CAACU,WAAW,GAAGE,IAAI,CAAC;OACxD,CAAC,OAAOM,KAAK,EAAE;QACdH,OAAO,CAACG,KAAK,CACX,2CAA2CR,WAAW,GAAGE,IAAI,EAAE,CAChE;QACDG,OAAO,CAACG,KAAK,CACX,uHAAuH,CACxH;;MAGH,IAAID,SAAS,EAAE;QACbtB,IAAI,CAACwB,GAAG,CAACF,SAAS,EAAEL,IAAI,CAAC;QACzBA,IAAI,IAAIK,SAAS,CAACG,MAAM;OACzB,MAAM;QACL,MAAM,IAAIxB,KAAK,CAAC,sCAAsCgB,IAAI,IAAIL,IAAI,EAAE,CAAC;;;IAIzE,OAAOZ,IAAI;EACb;;AAlEF0B,OAAA,CAAAC,OAAA,GAAAnC,MAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}