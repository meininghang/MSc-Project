{"ast":null,"code":"import _classPrivateFieldInitSpec from \"E:/Amanda-project/vue2-project/project-vue2/node_modules/@babel/runtime/helpers/esm/classPrivateFieldInitSpec.js\";\nimport _defineProperty from \"E:/Amanda-project/vue2-project/project-vue2/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _classPrivateFieldGet from \"E:/Amanda-project/vue2-project/project-vue2/node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet.js\";\nimport _classPrivateFieldSet from \"E:/Amanda-project/vue2-project/project-vue2/node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet.js\";\nimport { getAddress, resolveAddress } from \"../address/index.js\";\nimport { hashMessage, TypedDataEncoder } from \"../hash/index.js\";\nimport { AbstractSigner } from \"../providers/index.js\";\nimport { computeAddress, Transaction } from \"../transaction/index.js\";\nimport { defineProperties, resolveProperties, assert, assertArgument } from \"../utils/index.js\";\n/**\n *  The **BaseWallet** is a stream-lined implementation of a\n *  [[Signer]] that operates with a private key.\n *\n *  It is preferred to use the [[Wallet]] class, as it offers\n *  additional functionality and simplifies loading a variety\n *  of JSON formats, Mnemonic Phrases, etc.\n *\n *  This class may be of use for those attempting to implement\n *  a minimal Signer.\n */\nvar _signingKey = /*#__PURE__*/new WeakMap();\nexport class BaseWallet extends AbstractSigner {\n  /**\n   *  Creates a new BaseWallet for %%privateKey%%, optionally\n   *  connected to %%provider%%.\n   *\n   *  If %%provider%% is not specified, only offline methods can\n   *  be used.\n   */\n  constructor(privateKey, provider) {\n    super(provider);\n    /**\n     *  The wallet address.\n     */\n    _defineProperty(this, \"address\", void 0);\n    _classPrivateFieldInitSpec(this, _signingKey, {\n      writable: true,\n      value: void 0\n    });\n    assertArgument(privateKey && typeof privateKey.sign === \"function\", \"invalid private key\", \"privateKey\", \"[ REDACTED ]\");\n    _classPrivateFieldSet(this, _signingKey, privateKey);\n    const address = computeAddress(this.signingKey.publicKey);\n    defineProperties(this, {\n      address\n    });\n  }\n  // Store private values behind getters to reduce visibility\n  // in console.log\n  /**\n   *  The [[SigningKey]] used for signing payloads.\n   */\n  get signingKey() {\n    return _classPrivateFieldGet(this, _signingKey);\n  }\n  /**\n   *  The private key for this wallet.\n   */\n  get privateKey() {\n    return this.signingKey.privateKey;\n  }\n  async getAddress() {\n    return this.address;\n  }\n  connect(provider) {\n    return new BaseWallet(_classPrivateFieldGet(this, _signingKey), provider);\n  }\n  async signTransaction(tx) {\n    // Replace any Addressable or ENS name with an address\n    const {\n      to,\n      from\n    } = await resolveProperties({\n      to: tx.to ? resolveAddress(tx.to, this.provider) : undefined,\n      from: tx.from ? resolveAddress(tx.from, this.provider) : undefined\n    });\n    if (to != null) {\n      tx.to = to;\n    }\n    if (from != null) {\n      tx.from = from;\n    }\n    if (tx.from != null) {\n      assertArgument(getAddress(tx.from) === this.address, \"transaction from address mismatch\", \"tx.from\", tx.from);\n      delete tx.from;\n    }\n    // Build the transaction\n    const btx = Transaction.from(tx);\n    btx.signature = this.signingKey.sign(btx.unsignedHash);\n    return btx.serialized;\n  }\n  async signMessage(message) {\n    return this.signMessageSync(message);\n  }\n  // @TODO: Add a secialized signTx and signTyped sync that enforces\n  // all parameters are known?\n  /**\n   *  Returns the signature for %%message%% signed with this wallet.\n   */\n  signMessageSync(message) {\n    return this.signingKey.sign(hashMessage(message)).serialized;\n  }\n  async signTypedData(domain, types, value) {\n    // Populate any ENS names\n    const populated = await TypedDataEncoder.resolveNames(domain, types, value, async name => {\n      // @TODO: this should use resolveName; addresses don't\n      //        need a provider\n      assert(this.provider != null, \"cannot resolve ENS names without a provider\", \"UNSUPPORTED_OPERATION\", {\n        operation: \"resolveName\",\n        info: {\n          name\n        }\n      });\n      const address = await this.provider.resolveName(name);\n      assert(address != null, \"unconfigured ENS name\", \"UNCONFIGURED_NAME\", {\n        value: name\n      });\n      return address;\n    });\n    return this.signingKey.sign(TypedDataEncoder.hash(populated.domain, types, populated.value)).serialized;\n  }\n}","map":{"version":3,"names":["getAddress","resolveAddress","hashMessage","TypedDataEncoder","AbstractSigner","computeAddress","Transaction","defineProperties","resolveProperties","assert","assertArgument","_signingKey","WeakMap","BaseWallet","constructor","privateKey","provider","_defineProperty","_classPrivateFieldInitSpec","writable","value","sign","_classPrivateFieldSet","address","signingKey","publicKey","_classPrivateFieldGet","connect","signTransaction","tx","to","from","undefined","btx","signature","unsignedHash","serialized","signMessage","message","signMessageSync","signTypedData","domain","types","populated","resolveNames","name","operation","info","resolveName","hash"],"sources":["../../src.ts/wallet/base-wallet.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}