{"ast":null,"code":"import ethereumLib from './ethereum';\nimport arweaveLib from './arweave';\nimport { ChainType } from '../types';\nimport { checkSignConfig } from '../utils/check';\nimport { ERRORS } from '../utils/errors';\nimport hashPersonalMessage from './hashPersonalMessage';\nimport { getAccountChainType } from '../utils/util';\nconst getDepositAddr = (info, accountChainType) => {\n  if (accountChainType === ChainType.ethereum) {\n    return info === null || info === void 0 ? void 0 : info.lockers.ethereum;\n  } else if (accountChainType === ChainType.arweave) {\n    // AR 大小写敏感\n    return info === null || info === void 0 ? void 0 : info.lockers.arweave;\n  } else if (accountChainType === ChainType.moon) {\n    return info === null || info === void 0 ? void 0 : info.lockers.moon;\n  } else if (accountChainType === ChainType.conflux) {\n    return info === null || info === void 0 ? void 0 : info.lockers.conflux;\n  } else if (accountChainType === ChainType.bsc) {\n    return info === null || info === void 0 ? void 0 : info.lockers.bsc;\n  } else if (accountChainType === ChainType.platon) {\n    return info === null || info === void 0 ? void 0 : info.lockers.platon;\n  }\n  throw new Error(ERRORS.INVALID_ACCOUNT_TYPE);\n};\nexport const getEverpayTxMessage = everpayTxWithoutSig => {\n  const keys = ['tokenSymbol', 'action', 'from', 'to', 'amount', 'fee', 'feeRecipient', 'nonce', 'tokenID', 'chainType', 'chainID', 'data', 'version'];\n  return keys.map(key => `${key}:${everpayTxWithoutSig[key]}`).join('\\n');\n};\nexport const signMessageAsync = async (config, messageData) => {\n  const from = config.account;\n  const accountChainType = config.chainType;\n  const personalMsgHashBuffer = hashPersonalMessage(Buffer.from(messageData));\n  const personalMsgHex = `0x${personalMsgHashBuffer.toString('hex')}`;\n  let sig = '';\n  checkSignConfig(accountChainType, config);\n  if ([ChainType.ethereum, ChainType.moon, ChainType.conflux, ChainType.bsc, ChainType.platon].includes(accountChainType)) {\n    sig = await ethereumLib.signMessageAsync(config.ethConnectedSigner, from, messageData);\n  } else if (accountChainType === ChainType.arweave) {\n    sig = await arweaveLib.signMessageAsync(config.arJWK, from, personalMsgHex);\n  } else {\n    throw new Error(ERRORS.INVALID_ACCOUNT_TYPE);\n  }\n  return {\n    everHash: personalMsgHex,\n    sig\n  };\n};\nexport const verifySigAsync = async tx => {\n  const from = tx.from;\n  const chainType = getAccountChainType(from);\n  const messageData = getEverpayTxMessage(tx);\n  if (chainType === ChainType.arweave) {\n    return await arweaveLib.verifySigAsync(from, messageData, tx.sig);\n  } else {\n    return await ethereumLib.verifySigAsync(from, messageData, tx.sig);\n  }\n};\nexport const transferAsync = async (config, info, params) => {\n  checkSignConfig(config.chainType, config);\n  const to = getDepositAddr(info, config.chainType);\n  const paramsMergedTo = {\n    ...params,\n    to\n  };\n  if ([ChainType.ethereum, ChainType.moon, ChainType.conflux, ChainType.bsc, ChainType.platon].includes(config.chainType)) {\n    return await ethereumLib.transferAsync(config.ethConnectedSigner, config.chainType, paramsMergedTo);\n  } else if (config.chainType === ChainType.arweave) {\n    return await arweaveLib.transferAsync(config.arJWK, config.chainType, paramsMergedTo);\n  }\n  throw new Error(ERRORS.INVALID_ACCOUNT_TYPE);\n};","map":{"version":3,"names":["ethereumLib","arweaveLib","ChainType","checkSignConfig","ERRORS","hashPersonalMessage","getAccountChainType","getDepositAddr","info","accountChainType","ethereum","lockers","arweave","moon","conflux","bsc","platon","Error","INVALID_ACCOUNT_TYPE","getEverpayTxMessage","everpayTxWithoutSig","keys","map","key","join","signMessageAsync","config","messageData","from","account","chainType","personalMsgHashBuffer","Buffer","personalMsgHex","toString","sig","includes","ethConnectedSigner","arJWK","everHash","verifySigAsync","tx","transferAsync","params","to","paramsMergedTo"],"sources":["E:/Amanda-project/vue2-project/project-vue2/node_modules/arseeding-js/node_modules/everpay/esm/lib/sign.js"],"sourcesContent":["import ethereumLib from './ethereum';\nimport arweaveLib from './arweave';\nimport { ChainType } from '../types';\nimport { checkSignConfig } from '../utils/check';\nimport { ERRORS } from '../utils/errors';\nimport hashPersonalMessage from './hashPersonalMessage';\nimport { getAccountChainType } from '../utils/util';\nconst getDepositAddr = (info, accountChainType) => {\n    if (accountChainType === ChainType.ethereum) {\n        return info === null || info === void 0 ? void 0 : info.lockers.ethereum;\n    }\n    else if (accountChainType === ChainType.arweave) {\n        // AR 大小写敏感\n        return info === null || info === void 0 ? void 0 : info.lockers.arweave;\n    }\n    else if (accountChainType === ChainType.moon) {\n        return info === null || info === void 0 ? void 0 : info.lockers.moon;\n    }\n    else if (accountChainType === ChainType.conflux) {\n        return info === null || info === void 0 ? void 0 : info.lockers.conflux;\n    }\n    else if (accountChainType === ChainType.bsc) {\n        return info === null || info === void 0 ? void 0 : info.lockers.bsc;\n    }\n    else if (accountChainType === ChainType.platon) {\n        return info === null || info === void 0 ? void 0 : info.lockers.platon;\n    }\n    throw new Error(ERRORS.INVALID_ACCOUNT_TYPE);\n};\nexport const getEverpayTxMessage = (everpayTxWithoutSig) => {\n    const keys = [\n        'tokenSymbol',\n        'action',\n        'from',\n        'to',\n        'amount',\n        'fee',\n        'feeRecipient',\n        'nonce',\n        'tokenID',\n        'chainType',\n        'chainID',\n        'data',\n        'version'\n    ];\n    return keys.map(key => `${key}:${everpayTxWithoutSig[key]}`).join('\\n');\n};\nexport const signMessageAsync = async (config, messageData) => {\n    const from = config.account;\n    const accountChainType = config.chainType;\n    const personalMsgHashBuffer = hashPersonalMessage(Buffer.from(messageData));\n    const personalMsgHex = `0x${personalMsgHashBuffer.toString('hex')}`;\n    let sig = '';\n    checkSignConfig(accountChainType, config);\n    if ([\n        ChainType.ethereum,\n        ChainType.moon,\n        ChainType.conflux,\n        ChainType.bsc,\n        ChainType.platon\n    ].includes(accountChainType)) {\n        sig = await ethereumLib.signMessageAsync(config.ethConnectedSigner, from, messageData);\n    }\n    else if (accountChainType === ChainType.arweave) {\n        sig = await arweaveLib.signMessageAsync(config.arJWK, from, personalMsgHex);\n    }\n    else {\n        throw new Error(ERRORS.INVALID_ACCOUNT_TYPE);\n    }\n    return { everHash: personalMsgHex, sig };\n};\nexport const verifySigAsync = async (tx) => {\n    const from = tx.from;\n    const chainType = getAccountChainType(from);\n    const messageData = getEverpayTxMessage(tx);\n    if (chainType === ChainType.arweave) {\n        return await arweaveLib.verifySigAsync(from, messageData, tx.sig);\n    }\n    else {\n        return await ethereumLib.verifySigAsync(from, messageData, tx.sig);\n    }\n};\nexport const transferAsync = async (config, info, params) => {\n    checkSignConfig(config.chainType, config);\n    const to = getDepositAddr(info, config.chainType);\n    const paramsMergedTo = { ...params, to };\n    if ([\n        ChainType.ethereum,\n        ChainType.moon,\n        ChainType.conflux,\n        ChainType.bsc,\n        ChainType.platon\n    ].includes(config.chainType)) {\n        return await ethereumLib.transferAsync(config.ethConnectedSigner, config.chainType, paramsMergedTo);\n    }\n    else if (config.chainType === ChainType.arweave) {\n        return await arweaveLib.transferAsync(config.arJWK, config.chainType, paramsMergedTo);\n    }\n    throw new Error(ERRORS.INVALID_ACCOUNT_TYPE);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}