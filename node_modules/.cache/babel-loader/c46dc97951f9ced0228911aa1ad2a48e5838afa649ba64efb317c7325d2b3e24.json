{"ast":null,"code":"import { isAddress } from '@ethersproject/address';\nimport isString from 'lodash/isString';\nimport { v4 as uuidv4 } from 'uuid';\nimport BN from 'bignumber.js';\nimport { ERRORS } from './errors';\nimport { ChainType } from '../types';\nimport { bundleInternalTxVersion } from '../config';\nBN.config({\n  EXPONENTIAL_AT: 1000\n});\nexport const toBN = x => {\n  if (isNaN(Number(x))) return new BN(0);\n  if (x instanceof BN) return x;\n  if (typeof x === 'string') {\n    if (x.indexOf('0x') === 0 || x.indexOf('-0x') === 0) {\n      return new BN(x.replace('0x', ''), 16);\n    }\n  }\n  return new BN(x);\n};\nexport const fromUnitToDecimalBN = (x, decimals) => {\n  return toBN(x).times(toBN(10).pow(decimals));\n};\nexport const fromUnitToDecimal = (x, decimals) => {\n  return fromUnitToDecimalBN(x, decimals).toString();\n};\nexport const fromDecimalToUnitBN = (x, decimals) => {\n  return toBN(x).dividedBy(toBN(10).pow(decimals));\n};\nexport const fromDecimalToUnit = (x, decimals) => {\n  return fromDecimalToUnitBN(x, decimals).toString();\n};\nexport const getTimestamp = () => Math.round(Date.now() / 1000);\nexport const getTokenBySymbol = (symbol, tokenList) => {\n  return tokenList === null || tokenList === void 0 ? void 0 : tokenList.find(t => t.symbol.toUpperCase() === symbol.toUpperCase());\n};\nexport const getTokenByTag = (tag, tokenList) => {\n  return tokenList === null || tokenList === void 0 ? void 0 : tokenList.find(t => matchTokenTag(genTokenTag(t), tag));\n};\nconst isEthereumAddress = isAddress;\nconst isArweaveAddress = address => {\n  return isString(address) && address.length === 43 && address.search(/[a-z0-9A-Z_-]{43}/g) === 0;\n};\nexport const isArweaveChainPSTMode = token => {\n  if (token == null) return false;\n  return !!token.chainType.includes(ChainType.arweave) && token.symbol.toUpperCase() !== 'AR';\n};\nexport const getAccountChainType = from => {\n  if (isEthereumAddress(from)) {\n    return ChainType.ethereum;\n  }\n  if (isArweaveAddress(from)) {\n    return ChainType.arweave;\n  }\n  throw new Error(ERRORS.INVALID_ACCOUNT_TYPE);\n};\nexport const getTokenAddrByChainType = (token, chainType) => {\n  const crossChainInfo = token.crossChainInfoList[chainType];\n  return crossChainInfo.targetTokenId;\n};\nexport const getChainDecimalByChainType = (token, chainType) => {\n  const crossChainInfo = token.crossChainInfoList[chainType];\n  return crossChainInfo.targetDecimals;\n};\nexport const getTokenBurnFeeByChainType = (token, feeItem, chainType) => {\n  return feeItem.burnFeeMap[chainType];\n};\nexport const genTokenTag = token => {\n  const {\n    chainType,\n    symbol,\n    id\n  } = token;\n  const chainTypes = chainType.split(',');\n  const tokenAddrs = id.split(',').map((addr, index) => {\n    if (chainTypes[index] === ChainType.ethereum) {\n      return addr.toLowerCase();\n    }\n    return addr;\n  });\n  return `${chainType.toLowerCase()}-${symbol.toLowerCase()}-${tokenAddrs.join(',')}`;\n};\nexport const matchTokenTag = (tag1, tag2) => {\n  return tag1.toLowerCase() === tag2.toLowerCase();\n};\nexport const genExpressData = params => {\n  const {\n    chainType,\n    to,\n    fee\n  } = params;\n  return {\n    appId: 'express',\n    withdrawAction: 'pay',\n    withdrawTo: to,\n    withdrawChainType: chainType,\n    withdrawFee: fee\n  };\n};\nexport const genBundleData = params => {\n  const items = params.items.map(item => {\n    const {\n      symbol,\n      amount,\n      from,\n      to\n    } = item;\n    const token = getTokenBySymbol(symbol, params.tokenList);\n    // 注意：顺序必须与后端保持一致，来让 JSON.stringify() 生成的字符串顺序与后端也一致\n    return {\n      tag: genTokenTag(token),\n      chainID: token.chainID,\n      from,\n      to,\n      amount: fromUnitToDecimal(amount, token.decimals)\n    };\n  });\n  const salt = uuidv4();\n  const version = bundleInternalTxVersion;\n  return {\n    // 注意：顺序必须与后端保持一致，来让 JSON.stringify() 生成的字符串顺序与后端也一致\n    items,\n    expiration: params.expiration,\n    salt,\n    version\n  };\n};","map":{"version":3,"names":["isAddress","isString","v4","uuidv4","BN","ERRORS","ChainType","bundleInternalTxVersion","config","EXPONENTIAL_AT","toBN","x","isNaN","Number","indexOf","replace","fromUnitToDecimalBN","decimals","times","pow","fromUnitToDecimal","toString","fromDecimalToUnitBN","dividedBy","fromDecimalToUnit","getTimestamp","Math","round","Date","now","getTokenBySymbol","symbol","tokenList","find","t","toUpperCase","getTokenByTag","tag","matchTokenTag","genTokenTag","isEthereumAddress","isArweaveAddress","address","length","search","isArweaveChainPSTMode","token","chainType","includes","arweave","getAccountChainType","from","ethereum","Error","INVALID_ACCOUNT_TYPE","getTokenAddrByChainType","crossChainInfo","crossChainInfoList","targetTokenId","getChainDecimalByChainType","targetDecimals","getTokenBurnFeeByChainType","feeItem","burnFeeMap","id","chainTypes","split","tokenAddrs","map","addr","index","toLowerCase","join","tag1","tag2","genExpressData","params","to","fee","appId","withdrawAction","withdrawTo","withdrawChainType","withdrawFee","genBundleData","items","item","amount","chainID","salt","version","expiration"],"sources":["E:/Amanda-project/vue2-project/project-vue2/node_modules/arseeding-js/node_modules/everpay/esm/utils/util.js"],"sourcesContent":["import { isAddress } from '@ethersproject/address';\nimport isString from 'lodash/isString';\nimport { v4 as uuidv4 } from 'uuid';\nimport BN from 'bignumber.js';\nimport { ERRORS } from './errors';\nimport { ChainType } from '../types';\nimport { bundleInternalTxVersion } from '../config';\nBN.config({\n    EXPONENTIAL_AT: 1000\n});\nexport const toBN = (x) => {\n    if (isNaN(Number(x)))\n        return new BN(0);\n    if (x instanceof BN)\n        return x;\n    if (typeof x === 'string') {\n        if (x.indexOf('0x') === 0 || x.indexOf('-0x') === 0) {\n            return new BN((x).replace('0x', ''), 16);\n        }\n    }\n    return new BN(x);\n};\nexport const fromUnitToDecimalBN = (x, decimals) => {\n    return toBN(x).times(toBN(10).pow(decimals));\n};\nexport const fromUnitToDecimal = (x, decimals) => {\n    return fromUnitToDecimalBN(x, decimals).toString();\n};\nexport const fromDecimalToUnitBN = (x, decimals) => {\n    return toBN(x).dividedBy(toBN(10).pow(decimals));\n};\nexport const fromDecimalToUnit = (x, decimals) => {\n    return fromDecimalToUnitBN(x, decimals).toString();\n};\nexport const getTimestamp = () => Math.round(Date.now() / 1000);\nexport const getTokenBySymbol = (symbol, tokenList) => {\n    return tokenList === null || tokenList === void 0 ? void 0 : tokenList.find(t => t.symbol.toUpperCase() === symbol.toUpperCase());\n};\nexport const getTokenByTag = (tag, tokenList) => {\n    return tokenList === null || tokenList === void 0 ? void 0 : tokenList.find(t => matchTokenTag(genTokenTag(t), tag));\n};\nconst isEthereumAddress = isAddress;\nconst isArweaveAddress = (address) => {\n    return isString(address) && address.length === 43 && address.search(/[a-z0-9A-Z_-]{43}/g) === 0;\n};\nexport const isArweaveChainPSTMode = (token) => {\n    if (token == null)\n        return false;\n    return !!token.chainType.includes(ChainType.arweave) && token.symbol.toUpperCase() !== 'AR';\n};\nexport const getAccountChainType = (from) => {\n    if (isEthereumAddress(from)) {\n        return ChainType.ethereum;\n    }\n    if (isArweaveAddress(from)) {\n        return ChainType.arweave;\n    }\n    throw new Error(ERRORS.INVALID_ACCOUNT_TYPE);\n};\nexport const getTokenAddrByChainType = (token, chainType) => {\n    const crossChainInfo = token.crossChainInfoList[chainType];\n    return crossChainInfo.targetTokenId;\n};\nexport const getChainDecimalByChainType = (token, chainType) => {\n    const crossChainInfo = token.crossChainInfoList[chainType];\n    return crossChainInfo.targetDecimals;\n};\nexport const getTokenBurnFeeByChainType = (token, feeItem, chainType) => {\n    return feeItem.burnFeeMap[chainType];\n};\nexport const genTokenTag = (token) => {\n    const { chainType, symbol, id } = token;\n    const chainTypes = chainType.split(',');\n    const tokenAddrs = id.split(',').map((addr, index) => {\n        if (chainTypes[index] === ChainType.ethereum) {\n            return addr.toLowerCase();\n        }\n        return addr;\n    });\n    return `${chainType.toLowerCase()}-${symbol.toLowerCase()}-${tokenAddrs.join(',')}`;\n};\nexport const matchTokenTag = (tag1, tag2) => {\n    return tag1.toLowerCase() === tag2.toLowerCase();\n};\nexport const genExpressData = (params) => {\n    const { chainType, to, fee } = params;\n    return {\n        appId: 'express',\n        withdrawAction: 'pay',\n        withdrawTo: to,\n        withdrawChainType: chainType,\n        withdrawFee: fee\n    };\n};\nexport const genBundleData = (params) => {\n    const items = params.items.map((item) => {\n        const { symbol, amount, from, to } = item;\n        const token = getTokenBySymbol(symbol, params.tokenList);\n        // 注意：顺序必须与后端保持一致，来让 JSON.stringify() 生成的字符串顺序与后端也一致\n        return {\n            tag: genTokenTag(token),\n            chainID: token.chainID,\n            from,\n            to,\n            amount: fromUnitToDecimal(amount, token.decimals)\n        };\n    });\n    const salt = uuidv4();\n    const version = bundleInternalTxVersion;\n    return {\n        // 注意：顺序必须与后端保持一致，来让 JSON.stringify() 生成的字符串顺序与后端也一致\n        items,\n        expiration: params.expiration,\n        salt,\n        version\n    };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}