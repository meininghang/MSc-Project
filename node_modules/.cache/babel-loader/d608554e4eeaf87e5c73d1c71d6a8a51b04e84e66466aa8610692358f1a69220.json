{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.typed-array.to-reversed.js\");\nrequire(\"core-js/modules/es.typed-array.to-sorted.js\");\nrequire(\"core-js/modules/es.typed-array.with.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst ar_1 = require(\"./ar\");\nconst api_1 = require(\"./lib/api\");\nconst node_driver_1 = require(\"./lib/crypto/webcrypto-driver\");\nconst network_1 = require(\"./network\");\nconst transactions_1 = require(\"./transactions\");\nconst wallets_1 = require(\"./wallets\");\nconst transaction_1 = require(\"./lib/transaction\");\nconst ArweaveUtils = require(\"./lib/utils\");\nconst silo_1 = require(\"./silo\");\nconst chunks_1 = require(\"./chunks\");\nconst blocks_1 = require(\"./blocks\");\nclass Arweave {\n  constructor(apiConfig) {\n    this.api = new api_1.default(apiConfig);\n    this.wallets = new wallets_1.default(this.api, Arweave.crypto);\n    this.chunks = new chunks_1.default(this.api);\n    this.transactions = new transactions_1.default(this.api, Arweave.crypto, this.chunks);\n    this.silo = new silo_1.default(this.api, this.crypto, this.transactions);\n    this.network = new network_1.default(this.api);\n    this.blocks = new blocks_1.default(this.api, this.network);\n    this.ar = new ar_1.default();\n  }\n  /** @deprecated */\n  get crypto() {\n    return Arweave.crypto;\n  }\n  /** @deprecated */\n  get utils() {\n    return Arweave.utils;\n  }\n  getConfig() {\n    return {\n      api: this.api.getConfig(),\n      crypto: null\n    };\n  }\n  async createTransaction(attributes, jwk) {\n    const transaction = {};\n    Object.assign(transaction, attributes);\n    if (!attributes.data && !(attributes.target && attributes.quantity)) {\n      throw new Error(`A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.`);\n    }\n    if (attributes.owner == undefined) {\n      if (jwk && jwk !== \"use_wallet\") {\n        transaction.owner = jwk.n;\n      }\n    }\n    if (attributes.last_tx == undefined) {\n      transaction.last_tx = await this.transactions.getTransactionAnchor();\n    }\n    if (typeof attributes.data === \"string\") {\n      attributes.data = ArweaveUtils.stringToBuffer(attributes.data);\n    }\n    if (attributes.data instanceof ArrayBuffer) {\n      attributes.data = new Uint8Array(attributes.data);\n    }\n    if (attributes.data && !(attributes.data instanceof Uint8Array)) {\n      throw new Error(\"Expected data to be a string, Uint8Array or ArrayBuffer\");\n    }\n    if (attributes.reward == undefined) {\n      const length = attributes.data ? attributes.data.byteLength : 0;\n      transaction.reward = await this.transactions.getPrice(length, transaction.target);\n    }\n    // here we should call prepare chunk\n    transaction.data_root = \"\";\n    transaction.data_size = attributes.data ? attributes.data.byteLength.toString() : \"0\";\n    transaction.data = attributes.data || new Uint8Array(0);\n    const createdTransaction = new transaction_1.default(transaction);\n    await createdTransaction.getSignatureData();\n    return createdTransaction;\n  }\n  async createSiloTransaction(attributes, jwk, siloUri) {\n    const transaction = {};\n    Object.assign(transaction, attributes);\n    if (!attributes.data) {\n      throw new Error(`Silo transactions must have a 'data' value`);\n    }\n    if (!siloUri) {\n      throw new Error(`No Silo URI specified.`);\n    }\n    if (attributes.target || attributes.quantity) {\n      throw new Error(`Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.`);\n    }\n    if (attributes.owner == undefined) {\n      if (!jwk || !jwk.n) {\n        throw new Error(`A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.`);\n      }\n      transaction.owner = jwk.n;\n    }\n    if (attributes.last_tx == undefined) {\n      transaction.last_tx = await this.transactions.getTransactionAnchor();\n    }\n    const siloResource = await this.silo.parseUri(siloUri);\n    if (typeof attributes.data == \"string\") {\n      const encrypted = await this.crypto.encrypt(ArweaveUtils.stringToBuffer(attributes.data), siloResource.getEncryptionKey());\n      transaction.reward = await this.transactions.getPrice(encrypted.byteLength);\n      transaction.data = ArweaveUtils.bufferTob64Url(encrypted);\n    }\n    if (attributes.data instanceof Uint8Array) {\n      const encrypted = await this.crypto.encrypt(attributes.data, siloResource.getEncryptionKey());\n      transaction.reward = await this.transactions.getPrice(encrypted.byteLength);\n      transaction.data = ArweaveUtils.bufferTob64Url(encrypted);\n    }\n    const siloTransaction = new transaction_1.default(transaction);\n    siloTransaction.addTag(\"Silo-Name\", siloResource.getAccessKey());\n    siloTransaction.addTag(\"Silo-Version\", `0.1.0`);\n    return siloTransaction;\n  }\n  arql(query) {\n    return this.api.post(\"/arql\", query).then(response => response.data || []);\n  }\n}\nexports.default = Arweave;\nArweave.crypto = new node_driver_1.default();\nArweave.utils = ArweaveUtils;","map":{"version":3,"names":["ar_1","require","api_1","node_driver_1","network_1","transactions_1","wallets_1","transaction_1","ArweaveUtils","silo_1","chunks_1","blocks_1","Arweave","constructor","apiConfig","api","default","wallets","crypto","chunks","transactions","silo","network","blocks","ar","utils","getConfig","createTransaction","attributes","jwk","transaction","Object","assign","data","target","quantity","Error","owner","undefined","n","last_tx","getTransactionAnchor","stringToBuffer","ArrayBuffer","Uint8Array","reward","length","byteLength","getPrice","data_root","data_size","toString","createdTransaction","getSignatureData","createSiloTransaction","siloUri","siloResource","parseUri","encrypted","encrypt","getEncryptionKey","bufferTob64Url","siloTransaction","addTag","getAccessKey","arql","query","post","then","response","exports"],"sources":["../../../src/common/common.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}