"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.swapParamsServerToClient = exports.swapParamsClientToServer = void 0;
const errors_1 = require("./errors");
const util_1 = require("./util");
const getSwapTokensInfo = (params, everpayInfo, swapInfo) => {
    const { tokenIn, tokenOut } = params;
    const tokenInObj = util_1.getTokenBySymbol(tokenIn, everpayInfo.tokenList);
    const tokenOutObj = util_1.getTokenBySymbol(tokenOut, everpayInfo.tokenList);
    let tokenInTag = null;
    let tokenOutTag = null;
    if (tokenInObj == null || tokenOutObj == null) {
        throw new Error(errors_1.ERRORS.TOKEN_NOT_FOUND);
    }
    swapInfo.tokenList.forEach(tag => {
        if (util_1.matchTokenTag(util_1.genTokenTag(tokenInObj), tag)) {
            tokenInTag = tag;
        }
        if (util_1.matchTokenTag(util_1.genTokenTag(tokenOutObj), tag)) {
            tokenOutTag = tag;
        }
    });
    if (tokenInTag == null || tokenOutTag == null) {
        throw new Error(errors_1.ERRORS.UNSUPPORTED_TOKEN_SWAP);
    }
    return { tokenIn: tokenInObj, tokenOut: tokenOutObj, tokenInTag, tokenOutTag };
};
// symbol => tag, uint amount => decimal amount
const swapParamsClientToServer = (params, everpayInfo, swapInfo) => {
    const swapTokensInfo = getSwapTokensInfo(params, everpayInfo, swapInfo);
    const { tokenInAmount, tokenOutAmount } = params;
    let tokenInDecimalAmount = '';
    let tokenOutDecimalAmount = '';
    const result = {
        tokenIn: swapTokensInfo.tokenInTag,
        tokenOut: swapTokensInfo.tokenOutTag
    };
    if (tokenInAmount != null) {
        tokenInDecimalAmount = util_1.fromUnitToDecimal(tokenInAmount, swapTokensInfo.tokenIn.decimals);
        result.tokenInAmount = tokenInDecimalAmount;
    }
    if (tokenOutAmount != null) {
        tokenOutDecimalAmount = util_1.fromUnitToDecimal(tokenOutAmount, swapTokensInfo.tokenOut.decimals);
        result.tokenOutAmount = tokenOutDecimalAmount;
    }
    return result;
};
exports.swapParamsClientToServer = swapParamsClientToServer;
// tag => symbol, decimal amount => uint amount
const swapParamsServerToClient = (params, everpayInfo, swapInfo) => {
    const { tokenIn, tokenOut, tokenInAmount, tokenOutAmount } = params;
    const tokenInObj = util_1.getTokenByTag(tokenIn, everpayInfo.tokenList);
    const tokenOutObj = util_1.getTokenByTag(tokenOut, everpayInfo.tokenList);
    const result = {
        tokenIn: tokenInObj.symbol,
        tokenOut: tokenOutObj.symbol
    };
    if (tokenInAmount != null) {
        result.tokenInAmount = util_1.fromDecimalToUnit(tokenInAmount, tokenInObj.decimals);
    }
    if (tokenOutAmount != null) {
        result.tokenOutAmount = util_1.fromDecimalToUnit(tokenOutAmount, tokenOutObj.decimals);
    }
    return result;
};
exports.swapParamsServerToClient = swapParamsServerToClient;
